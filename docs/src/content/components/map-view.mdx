import { Callout, Tabs } from 'nextra/components'

# NaverMapView

`NaverMapView`는 네이버 지도를 표시하는 핵심 컴포넌트입니다. 모든 오버레이와 마커의 부모 컴포넌트 역할을 합니다.

## 기본 사용법

```tsx
import { NaverMapView } from '@mj-studio/react-native-naver-map';

function BasicMap() {
  return (
    <NaverMapView
      style={{ flex: 1 }}
      initialRegion={{
        latitude: 37.5665,
        longitude: 126.9780,
        latitudeDelta: 0.01,
        longitudeDelta: 0.01,
      }}
    />
  );
}
```

## 주요 Props

### 지도 초기화

| Prop | 타입 | 설명 |
|---|---|---|
| `initialRegion` | `Region` | 초기 지도 영역 |
| `mapType` | `MapType` | 지도 유형 (Basic, Navi, Satellite, Hybrid, Terrain) |
| `layerGroups` | `LayerGroup` | 레이어 그룹 설정 |

### UI 컨트롤

| Prop | 타입 | 기본값 | 설명 |
|---|---|---|---|
| `isShowCompass` | `boolean` | `true` | 나침반 표시 |
| `isShowScaleBar` | `boolean` | `true` | 축척바 표시 |
| `isShowZoomControls` | `boolean` | `true` | 줌 컨트롤 표시 |
| `isShowLocationButton` | `boolean` | `false` | 현재 위치 버튼 표시 |
| `isShowIndoorLevelPicker` | `boolean` | `true` | 실내 지도 층 선택기 표시 |

### 지도 설정

| Prop | 타입 | 설명 |
|---|---|---|
| `isIndoorEnabled` | `boolean` | 실내 지도 활성화 |
| `isNightModeEnabled` | `boolean` | 야간 모드 활성화 |
| `isLiteModeEnabled` | `boolean` | 라이트 모드 활성화 |
| `symbolScale` | `number` | 심볼 크기 (0.5 ~ 2.0) |
| `lightness` | `number` | 지도 밝기 (-1.0 ~ 1.0) |

## 지도 유형

<Tabs items={['Basic', 'Navi', 'Satellite', 'Hybrid', 'Terrain']}>
  <Tabs.Tab>
    ```tsx
    <NaverMapView mapType="Basic" />
    ```
    기본 지도 - 일반적인 지도 표시
  </Tabs.Tab>
  <Tabs.Tab>
    ```tsx
    <NaverMapView mapType="Navi" />
    ```
    내비게이션용 지도 - 도로 정보 강조
  </Tabs.Tab>
  <Tabs.Tab>
    ```tsx
    <NaverMapView mapType="Satellite" />
    ```
    위성 지도 - 실제 위성 사진
  </Tabs.Tab>
  <Tabs.Tab>
    ```tsx
    <NaverMapView mapType="Hybrid" />
    ```
    하이브리드 - 위성 사진 + 도로 정보
  </Tabs.Tab>
  <Tabs.Tab>
    ```tsx
    <NaverMapView mapType="Terrain" />
    ```
    지형도 - 고도 정보 표시
  </Tabs.Tab>
</Tabs>

## 레이어 그룹

여러 정보 레이어를 토글할 수 있습니다:

```tsx
<NaverMapView
  layerGroups={{
    BUILDING: true,      // 건물
    TRAFFIC: true,       // 실시간 교통정보
    TRANSIT: true,       // 대중교통
    BICYCLE: false,      // 자전거 도로
    MOUNTAIN: false,     // 등산로
    CADASTRAL: false,    // 지적도
  }}
/>
```

## 이벤트 처리

### 지도 이벤트

```tsx
<NaverMapView
  onInitialized={() => {
    console.log('지도가 초기화되었습니다');
  }}
  onOptionChanged={(event) => {
    console.log('옵션 변경:', event);
  }}
  onCameraChanged={(event) => {
    console.log('카메라 변경:', event);
    // event.latitude, event.longitude, event.zoom
  }}
  onTapMap={(event) => {
    console.log('지도 탭:', event.latitude, event.longitude);
  }}
/>
```

### 카메라 이벤트 상세

```tsx
interface CameraChangedEvent {
  latitude: number;
  longitude: number;
  zoom: number;
  tilt: number;
  bearing: number;
  reason: CameraChangeReason;
}

// 카메라 변경 이유
type CameraChangeReason = 
  | 'gesture'     // 사용자 제스처
  | 'control'     // UI 컨트롤
  | 'location'    // 위치 추적
  | 'program';    // 프로그래밍
```

## Ref를 통한 명령형 제어

```tsx
import { useRef } from 'react';
import type { NaverMapViewRef } from '@mj-studio/react-native-naver-map';

function ControlledMap() {
  const mapRef = useRef<NaverMapViewRef>(null);

  const moveToSeoul = () => {
    mapRef.current?.animateCameraTo({
      latitude: 37.5665,
      longitude: 126.9780,
      zoom: 12,
      duration: 1000, // 애니메이션 시간 (ms)
    });
  };

  const captureMap = async () => {
    const uri = await mapRef.current?.takeSnapshot();
    console.log('스냅샷 저장:', uri);
  };

  return (
    <>
      <NaverMapView ref={mapRef} style={{ flex: 1 }} />
      <Button title="서울로 이동" onPress={moveToSeoul} />
      <Button title="스냅샷" onPress={captureMap} />
    </>
  );
}
```

### 사용 가능한 명령

| 명령 | 설명 |
|---|---|
| `animateCameraTo(params)` | 카메라를 애니메이션과 함께 이동 |
| `animateRegionTo(region)` | 지역으로 애니메이션 이동 |
| `setCameraTo(params)` | 카메라 즉시 이동 |
| `setRegionTo(region)` | 지역으로 즉시 이동 |
| `setLocationTrackingMode(mode)` | 위치 추적 모드 설정 |
| `takeSnapshot(options)` | 지도 스냅샷 캡처 |
| `screenToCoordinate(point)` | 화면 좌표를 지도 좌표로 변환 |
| `coordinateToScreen(coord)` | 지도 좌표를 화면 좌표로 변환 |

## 위치 추적 모드

```tsx
enum LocationTrackingMode {
  None = 0,      // 추적 안함
  NoFollow = 1,  // 위치만 표시
  Follow = 2,    // 위치 추적
  Face = 3,      // 위치 + 방향 추적
}

// 사용 예
mapRef.current?.setLocationTrackingMode(LocationTrackingMode.Follow);
```

<Callout type="info">
  위치 추적을 사용하려면 위치 권한이 필요하며 `isShowLocationButton`을 `true`로 설정해야 합니다.
</Callout>

## 지도 범위 제한

한국 영역으로 지도 범위를 제한할 수 있습니다:

```tsx
<NaverMapView
  isExtentBoundedInKorea={true}
  minZoom={5}
  maxZoom={18}
/>
```

## 성능 최적화

### 라이트 모드

마커가 많거나 성능이 중요한 경우:

```tsx
<NaverMapView
  isLiteModeEnabled={true}
  // 라이트 모드에서는 제스처와 애니메이션이 제한됩니다
/>
```

### 심볼 스케일 조정

```tsx
<NaverMapView
  symbolScale={0.8} // 심볼 크기 줄이기
/>
```

## 스타일링

### 야간 모드

```tsx
<NaverMapView
  isNightModeEnabled={true}
  lightness={-0.3} // 더 어둡게
/>
```

### 로고 위치

```tsx
<NaverMapView
  logoAlign="BottomLeft" // TopLeft, TopRight, BottomLeft, BottomRight
  logoMargin={{ x: 10, y: 10 }}
/>
```

## 전체 예제

```tsx
import React, { useRef } from 'react';
import { View, Button, StyleSheet } from 'react-native';
import { NaverMapView, NaverMapMarkerOverlay } from '@mj-studio/react-native-naver-map';

export default function FullExample() {
  const mapRef = useRef(null);

  return (
    <View style={styles.container}>
      <NaverMapView
        ref={mapRef}
        style={styles.map}
        initialRegion={{
          latitude: 37.5665,
          longitude: 126.9780,
          latitudeDelta: 0.01,
          longitudeDelta: 0.01,
        }}
        mapType="Basic"
        layerGroups={{
          TRAFFIC: true,
          TRANSIT: true,
        }}
        isShowLocationButton={true}
        isShowCompass={true}
        isShowScaleBar={true}
        onInitialized={() => console.log('Map initialized')}
        onCameraChanged={(e) => console.log('Camera:', e)}
      >
        <NaverMapMarkerOverlay
          latitude={37.5665}
          longitude={126.9780}
          anchor={{ x: 0.5, y: 1 }}
          caption={{ text: "서울시청" }}
        />
      </NaverMapView>
      
      <View style={styles.controls}>
        <Button 
          title="현재 위치로" 
          onPress={() => mapRef.current?.setLocationTrackingMode(2)}
        />
      </View>
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1 },
  map: { flex: 1 },
  controls: {
    position: 'absolute',
    bottom: 20,
    left: 20,
    right: 20,
  },
});
```