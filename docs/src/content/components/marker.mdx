import { Callout, Tabs } from 'nextra/components'

# 마커 (NaverMapMarkerOverlay)

마커는 지도 위의 특정 위치를 표시하는 가장 기본적인 오버레이입니다.

## 기본 사용법

```tsx
import { NaverMapView, NaverMapMarkerOverlay } from '@mj-studio/react-native-naver-map';

function MapWithMarker() {
  return (
    <NaverMapView style={{ flex: 1 }}>
      <NaverMapMarkerOverlay
        latitude={37.5665}
        longitude={126.9780}
        anchor={{ x: 0.5, y: 1 }}
        caption={{ text: "서울시청" }}
      />
    </NaverMapView>
  );
}
```

## 마커 이미지 타입

React Native Naver Map은 5가지 마커 이미지 타입을 지원합니다:

### 1. 기본 심볼

네이버 지도가 제공하는 기본 심볼을 사용합니다:

```tsx
<NaverMapMarkerOverlay
  latitude={37.5665}
  longitude={126.9780}
  image={{ symbol: 'green' }}
/>
```

사용 가능한 심볼: `green`, `red`, `blue`, `yellow`, `gray`, `pink`, `lightblue`

### 2. 로컬 이미지 리소스

```tsx
<NaverMapMarkerOverlay
  latitude={37.5665}
  longitude={126.9780}
  image={require('./assets/marker.png')}
  width={40}
  height={40}
/>
```

<Callout type="info">
  Debug/Release 빌드 시 크기가 다르게 나올 수 있으므로 `width`와 `height`를 명시하는 것을 권장합니다.
</Callout>

### 3. 네이티브 리소스

<Tabs items={['iOS', 'Android']}>
  <Tabs.Tab>
    ```tsx
    // iOS: Bundle의 이미지 asset
    <NaverMapMarkerOverlay
      image={{ assetName: 'marker_icon' }}
      width={40}
      height={40}
    />
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```tsx
    // Android: drawable 리소스
    <NaverMapMarkerOverlay
      image={{ assetName: 'ic_marker' }}
      width={40}
      height={40}
    />
    ```
  </Tabs.Tab>
</Tabs>

### 4. 네트워크 이미지

```tsx
<NaverMapMarkerOverlay
  latitude={37.5665}
  longitude={126.9780}
  image={{ httpUri: 'https://example.com/marker.png' }}
  width={40}
  height={40}
/>
```

### 5. 커스텀 React View

```tsx
<NaverMapMarkerOverlay
  latitude={37.5665}
  longitude={126.9780}
  width={100}
  height={100}
>
  <View 
    key={`${text}/${color}`} // 변경사항 추적을 위한 key
    collapsable={false}       // iOS New Architecture 필수
    style={styles.customMarker}
  >
    <Text>{text}</Text>
    <Icon name="location" color={color} />
  </View>
</NaverMapMarkerOverlay>
```

<Callout type="warning">
  커스텀 View는 성능에 영향을 줄 수 있습니다. 대량의 마커에는 이미지 사용을 권장합니다.
</Callout>

## 캡션과 서브캡션

마커에 텍스트 라벨을 추가할 수 있습니다:

```tsx
<NaverMapMarkerOverlay
  latitude={37.5665}
  longitude={126.9780}
  caption={{
    text: "메인 텍스트",
    textSize: 16,
    color: '#000000',
    haloColor: '#FFFFFF',
  }}
  subCaption={{
    text: "서브 텍스트",
    textSize: 12,
    color: '#666666',
  }}
/>
```

### 캡션 속성

| 속성 | 타입 | 설명 |
|---|---|---|
| `text` | `string` | 표시할 텍스트 |
| `textSize` | `number` | 텍스트 크기 |
| `color` | `string` | 텍스트 색상 |
| `haloColor` | `string` | 텍스트 테두리 색상 |
| `requestedWidth` | `number` | 요청 너비 |
| `minZoom` | `number` | 최소 줌 레벨 |
| `maxZoom` | `number` | 최대 줌 레벨 |

## 마커 설정

### 앵커 포인트

앵커는 마커 이미지의 어느 지점이 좌표에 위치할지 결정합니다:

```tsx
<NaverMapMarkerOverlay
  anchor={{ x: 0.5, y: 1 }} // 하단 중앙
  // x: 0 (왼쪽) ~ 1 (오른쪽)
  // y: 0 (상단) ~ 1 (하단)
/>
```

### Z-Index

마커의 렌더링 순서를 제어합니다:

```tsx
<NaverMapMarkerOverlay
  zIndex={1000} // 높을수록 위에 표시
  isIconPerspectiveEnabled={true} // 원근감 적용
/>
```

### 표시 설정

```tsx
<NaverMapMarkerOverlay
  isHidden={false}           // 마커 숨김/표시
  isHideCollidedSymbols={true} // 충돌하는 심볼 숨김
  isHideCollidedMarkers={false} // 충돌하는 마커 숨김
  isHideCollidedCaptions={true} // 충돌하는 캡션 숨김
  isForceShowIcon={false}     // 아이콘 강제 표시
  isForceShowCaption={false}  // 캡션 강제 표시
/>
```

## 이벤트 처리

```tsx
<NaverMapMarkerOverlay
  latitude={37.5665}
  longitude={126.9780}
  onTap={() => {
    console.log('마커가 탭되었습니다');
    // 정보 창 표시, 상세 화면 이동 등
  }}
/>
```

## 성능 최적화

### 이미지 캐싱

동일한 이미지를 사용하는 마커들에 대해 자동으로 캐싱이 적용됩니다:

```tsx
// reuseIdentifier는 자동으로 처리됨
<NaverMapMarkerOverlay
  image={require('./marker.png')}
  // 동일한 이미지는 캐싱되어 재사용
/>
```

### 대량 마커 처리

```tsx
function OptimizedMarkers({ markers }) {
  // 보이는 영역의 마커만 렌더링
  const visibleMarkers = useMemo(() => {
    return markers.filter(marker => 
      isInViewport(marker, currentRegion)
    );
  }, [markers, currentRegion]);

  return (
    <NaverMapView>
      {visibleMarkers.map(marker => (
        <NaverMapMarkerOverlay
          key={marker.id}
          latitude={marker.lat}
          longitude={marker.lng}
          image={{ symbol: 'green' }}
        />
      ))}
    </NaverMapView>
  );
}
```

## 애니메이션

마커 위치 변경 시 애니메이션:

```tsx
const AnimatedMarker = () => {
  const [position, setPosition] = useState({ lat: 37.5665, lng: 126.9780 });

  useEffect(() => {
    // 위치가 변경되면 자동으로 애니메이션 적용
    const timer = setTimeout(() => {
      setPosition({ lat: 37.5670, lng: 126.9785 });
    }, 2000);
    return () => clearTimeout(timer);
  }, []);

  return (
    <NaverMapMarkerOverlay
      latitude={position.lat}
      longitude={position.lng}
      // 위치 변경 시 부드럽게 이동
    />
  );
};
```

## 전체 예제

```tsx
import React, { useState } from 'react';
import { View, Text, StyleSheet } from 'react-native';
import { 
  NaverMapView, 
  NaverMapMarkerOverlay 
} from '@mj-studio/react-native-naver-map';

export default function MarkerExample() {
  const [selectedMarker, setSelectedMarker] = useState(null);

  const markers = [
    { id: 1, lat: 37.5665, lng: 126.9780, name: "서울시청", type: "gov" },
    { id: 2, lat: 37.5651, lng: 126.9785, name: "덕수궁", type: "palace" },
    { id: 3, lat: 37.5660, lng: 126.9770, name: "광화문", type: "landmark" },
  ];

  const getMarkerColor = (type) => {
    switch(type) {
      case 'gov': return 'blue';
      case 'palace': return 'green';
      case 'landmark': return 'red';
      default: return 'gray';
    }
  };

  return (
    <NaverMapView style={styles.map}>
      {markers.map(marker => (
        <NaverMapMarkerOverlay
          key={marker.id}
          latitude={marker.lat}
          longitude={marker.lng}
          image={{ symbol: getMarkerColor(marker.type) }}
          anchor={{ x: 0.5, y: 1 }}
          caption={{
            text: marker.name,
            textSize: selectedMarker?.id === marker.id ? 16 : 14,
            color: selectedMarker?.id === marker.id ? '#FF0000' : '#000000',
          }}
          width={selectedMarker?.id === marker.id ? 50 : 40}
          height={selectedMarker?.id === marker.id ? 50 : 40}
          onTap={() => setSelectedMarker(marker)}
        />
      ))}
      
      {/* 커스텀 마커 예제 */}
      <NaverMapMarkerOverlay
        latitude={37.5675}
        longitude={126.9790}
        width={80}
        height={80}
      >
        <View style={styles.customMarker} collapsable={false}>
          <Text style={styles.markerText}>커스텀</Text>
        </View>
      </NaverMapMarkerOverlay>
    </NaverMapView>
  );
}

const styles = StyleSheet.create({
  map: {
    flex: 1,
  },
  customMarker: {
    width: 80,
    height: 80,
    backgroundColor: 'white',
    borderRadius: 40,
    justifyContent: 'center',
    alignItems: 'center',
    borderWidth: 2,
    borderColor: 'blue',
  },
  markerText: {
    color: 'blue',
    fontWeight: 'bold',
  },
});
```