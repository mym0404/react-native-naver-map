import { Callout, Steps, Tabs, FileTree } from 'nextra/components'

# Android 설정

Android 플랫폼에서 React Native Naver Map을 설정하는 상세 가이드입니다.

## 요구사항

- Android 6.0 (API 레벨 23) 이상
- Kotlin 1.8.0 이상
- Gradle 7.0 이상

## 설정 단계

<Steps>
### Maven 저장소 추가

`android/build.gradle` 파일을 열고 네이버 Maps Maven 저장소를 추가합니다:

```groovy {5-7}
allprojects {
    repositories {
        google()
        mavenCentral()
        maven {
            url "https://repository.map.naver.com/archive/maven"
        }
    }
}
```

<Callout type="info">
  이 저장소는 네이버 지도 SDK를 다운로드하는 데 필요합니다.
</Callout>

### API 키 설정

`android/app/src/main/AndroidManifest.xml` 파일에 API 키를 추가합니다:

```xml {5-7,9-11}
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    <application
        android:name=".MainApplication"
        ... >
        <meta-data
            android:name="com.naver.maps.map.NCP_KEY_ID"
            android:value="YOUR_CLIENT_ID_HERE" />
        
        <!-- 2025.04.17 이전 AI NAVER API 고객용 (선택사항) -->
        <meta-data
            android:name="com.naver.maps.map.CLIENT_ID"
            android:value="YOUR_CLIENT_ID_HERE" />
            
        <activity ... />
    </application>
</manifest>
```

### 위치 권한 설정

사용자의 현재 위치를 표시하려면 위치 권한을 추가합니다:

```xml {2-5}
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
    <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
    <!-- 백그라운드 위치 (선택사항) -->
    <uses-permission android:name="android.permission.ACCESS_BACKGROUND_LOCATION" />
    
    <application ... />
</manifest>
```

### ProGuard 설정 (Release 빌드)

Release 빌드 시 코드 난독화로 인한 문제를 방지하기 위해 `android/app/proguard-rules.pro`에 다음을 추가합니다:

```pro
# Naver Maps SDK
-keep class com.naver.maps.** { *; }
-keep interface com.naver.maps.** { *; }
```

### 빌드 및 실행

모든 설정이 완료되면 앱을 빌드하고 실행합니다:

<Tabs items={['npm', 'yarn', 'pnpm']}>
  <Tabs.Tab>
    ```bash
    npm run android
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    yarn android
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    pnpm android
    ```
  </Tabs.Tab>
</Tabs>
</Steps>

## 권한 요청 구현

### react-native-permissions 사용

<Tabs items={['설치', '코드']}>
  <Tabs.Tab>
    ```bash
    npm install react-native-permissions
    ```
    
    `android/app/src/main/AndroidManifest.xml`에 권한이 추가되어 있는지 확인합니다.
  </Tabs.Tab>
  
  <Tabs.Tab>
    ```tsx
    import { requestMultiple, PERMISSIONS } from 'react-native-permissions';
    
    const requestLocationPermission = async () => {
      try {
        const result = await requestMultiple([
          PERMISSIONS.ANDROID.ACCESS_FINE_LOCATION,
          PERMISSIONS.ANDROID.ACCESS_COARSE_LOCATION,
        ]);
        
        if (result[PERMISSIONS.ANDROID.ACCESS_FINE_LOCATION] === 'granted') {
          console.log('위치 권한이 허용되었습니다');
        }
      } catch (error) {
        console.error('위치 권한 요청 실패:', error);
      }
    };
    ```
  </Tabs.Tab>
</Tabs>

## 일반적인 문제 해결

### 빌드 오류

<Callout type="error" emoji="❌">
  **"Could not find com.naver.maps.map:..."** 오류가 발생하는 경우
</Callout>

Maven 저장소가 올바르게 추가되었는지 확인하세요:

```groovy
maven {
    url "https://repository.map.naver.com/archive/maven"
}
```

### API 키 오류

<Callout type="error" emoji="❌">
  **"인증 실패"** 메시지가 표시되는 경우
</Callout>

1. API 키가 올바른지 확인
2. 네이버 클라우드 콘솔에서 패키지명이 일치하는지 확인
3. AndroidManifest.xml에 키가 올바르게 설정되었는지 확인

### 위치 권한 문제

<Callout type="warning" emoji="⚠️">
  **위치 버튼이 작동하지 않는 경우**
</Callout>

Android 6.0 이상에서는 런타임 권한이 필요합니다. 앱에서 권한을 요청하는 코드를 구현했는지 확인하세요.

## 고급 설정

### 멀티 덱스 활성화

메서드 수 제한 문제가 발생하면 멀티덱스를 활성화합니다:

```groovy
android {
    defaultConfig {
        multiDexEnabled true
    }
}

dependencies {
    implementation 'androidx.multidex:multidex:2.0.1'
}
```

### 빌드 변형별 API 키 설정

환경별로 다른 API 키를 사용하려면:

```groovy
android {
    buildTypes {
        debug {
            manifestPlaceholders = [naverMapApiKey: "DEBUG_KEY"]
        }
        release {
            manifestPlaceholders = [naverMapApiKey: "RELEASE_KEY"]
        }
    }
}
```

AndroidManifest.xml:

```xml
<meta-data
    android:name="com.naver.maps.map.NCP_KEY_ID"
    android:value="${naverMapApiKey}" />
```

## 다음 단계

- [iOS 설정](/installation/ios) - iOS 플랫폼 설정
- [컴포넌트 사용법](/components) - 지도 컴포넌트 활용
- [권한 가이드](/guides/permissions) - 상세 권한 설정